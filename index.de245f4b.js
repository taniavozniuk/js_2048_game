const t=new class{constructor(t=null){this.rows=4,this.columns=4,this.score=0,this.status="idle",this.board=t||this.createEmptyBoard()}createEmptyBoard(){return Array.from({length:this.rows},()=>Array(this.columns).fill(0))}start(){("idle"===this.status||"lose"===this.status)&&(this.status="playing",this.board=this.createEmptyBoard(),this.addNewNumber(),this.addNewNumber())}restart(){this.start(),this.score=0}getScore(){return this.score}getState(){return this.board}setStatus(t){this.status=t}getStatus(){return this.status}calculateBoardSum(){return this.board.flat().filter(Boolean).reduce((t,e)=>t+e,0)}addNewNumber(){let t=[];for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)0===this.board[e][s]&&t.push({row:e,col:s});if(0===t.length){this.updateStatus();return}let{row:e,col:s}=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.9>Math.random()?2:4}slideRowLeft(t){let e=t.filter(t=>0!==t),s=[],r=0;for(let t=0;t<e.length;t++)if(e[t]===e[t+1]){let o=2*e[t];s.push(o),r+=o,t++}else s.push(e[t]);for(;s.length<this.columns;)s.push(0);return{newRow:s,scoreGained:r}}moveLeft(){let t=!1,e=0;for(let s=0;s<this.rows;s++){let r=[...this.board[s]],{newRow:o,scoreGained:i}=this.slideRowLeft(this.board[s]);o.toString()!==r.toString()&&(t=!0),this.board[s]=o,e+=i}return t&&(this.score+=e,this.addNewNumber()),t}moveRight(){let t=!1,e=0;return this.board=this.board.map(s=>{let r=[...s],{newRow:o,scoreGained:i}=this.slideRowLeft(s.reverse()),a=o.reverse();return a.toString()!==r.toString()&&(t=!0),e+=i,a}),t&&(this.score+=e,this.addNewNumber()),t}moveUp(){this.transposeBoard();let t=this.moveLeft();return this.transposeBoard(),t}moveDown(){this.transposeBoard();let t=this.moveRight();return this.transposeBoard(),t}transposeBoard(){let t=this.createEmptyBoard();for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)t[s][e]=this.board[e][s];this.board=t}updateStatus(){let t=!1,e=!1;for(let s=0;s<this.rows;s++)for(let r=0;r<this.columns;r++){if(0===this.board[s][r]&&(t=!0),(r<this.columns-1&&this.board[s][r]===this.board[s][r+1]||s<this.rows-1&&this.board[s][r]===this.board[s+1][r])&&(e=!0),t||e){this.status="playing";return}if(2048===this.board[s][r]){this.status="win";return}}this.status="lose"}hasMoves(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)if(0===this.board[t][e]||e<this.columns-1&&this.board[t][e]===this.board[t][e+1]||t<this.rows-1&&this.board[t][e]===this.board[t+1][e])return!0;return!1}},e=document.querySelector(".button.start");function s(){let e=t.getState(),s=document.querySelectorAll(".field-row");if(s&&0!==s.length){for(let t=0;t<4;t++){let i=s[t].children;for(let s=0;s<4;s++){var r,o;r=i[s],o=e[t][s],r.textContent="",r.className="field-cell",o>0&&(r.textContent=o,o<=1024?r.classList.add(`field-cell--${o}`):r.classList.add("field-cell--2048"))}}document.querySelector(".game-score").textContent=`${t.getScore()}`}}e.addEventListener("click",()=>{if("idle"===t.getStatus())t.start();else{let e=document.querySelector(".message-lose"),s=document.querySelector(".message-win");e&&(e.style.display="none"),s&&s.classList.add("hidden"),t.restart()}s();let r=document.querySelector(".message-start");r&&(r.style.display="none"),e.textContent="Restart",e.style.backgroundColor="red",e.style.color="white",e.style.border="none",e.style.fontSize="16px"}),document.addEventListener("keyup",function(e){if(t&&"playing"===t.getStatus()){switch(e.code){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;default:return}s(),function(t){for(let e=0;e<4;e++)for(let s=0;s<4;s++)if(2048===t[e][s])return!0;return!1}(t.getState())?(t.setStatus("win"),function(){let t=document.querySelector(".message-win");t&&t.classList.remove("hidden")}()):function(t){for(let e=0;e<4;e++)for(let s=0;s<4;s++)if(0===t[e][s]||s<3&&t[e][s]===t[e][s+1]||e<3&&t[e][s]===t[e+1][s])return!1;return!0}(t.getState())&&(t.setStatus("lose"),function(){let t=document.querySelector(".message-lose");t&&(t.style.display="block",t.classList.remove("hidden"))}())}});
//# sourceMappingURL=index.de245f4b.js.map
